<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI è¯­éŸ³é—®ç­”ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 
                         'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .content {
            padding: 30px;
        }
        
        .input-section {
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .input-group input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
            min-width: 150px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-section {
            margin-top: 30px;
            display: none;
            animation: slideIn 0.5s;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .result-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .answer-text {
            line-height: 1.8;
            font-size: 1.05em;
            color: #333;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .audio-player {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .audio-player h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .audio-player audio {
            width: 100%;
            outline: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .examples {
            margin-top: 20px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 10px;
        }
        
        .examples h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .examples ul {
            list-style: none;
            padding: 0;
        }
        
        .examples li {
            padding: 8px 0;
            cursor: pointer;
            color: #555;
            transition: color 0.3s;
        }
        
        .examples li:hover {
            color: #667eea;
        }
        
        .examples li:before {
            content: "ğŸ’¬ ";
        }
        
        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ™ï¸ AI è¯­éŸ³é—®ç­”ç³»ç»Ÿ</h1>
            <p>åŸºäº DeepSeek + CosyVoice çš„æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹</p>
        </div>
        
        <div class="content">
            <div class="input-section">
                <h3 style="color: #667eea; margin-bottom: 15px;">è¯·è¾“å…¥æ‚¨çš„é—®é¢˜</h3>
                
                <div class="input-group">
                    <input 
                        type="text" 
                        id="questionInput" 
                        placeholder="ä¾‹å¦‚ï¼šå¦‚ä½•é¢„é˜²å¿ƒè¡€ç®¡ç–¾ç—…ï¼Ÿ"
                        autocomplete="off"
                    >
                    <button class="btn" id="submitBtn" onclick="submitQuestion()">
                        æäº¤é—®é¢˜
                    </button>
                </div>
                
                <div class="examples">
                    <h4>ğŸ’¡ ç¤ºä¾‹é—®é¢˜ï¼ˆç‚¹å‡»å¿«é€Ÿå¡«å…¥ï¼‰</h4>
                    <ul>
                        <li onclick="fillQuestion('å¦‚ä½•é¢„é˜²å¿ƒè¡€ç®¡ç–¾ç—…ï¼Ÿ')">å¦‚ä½•é¢„é˜²å¿ƒè¡€ç®¡ç–¾ç—…ï¼Ÿ</li>
                        <li onclick="fillQuestion('é«˜è¡€å‹æ‚£è€…åº”è¯¥æ³¨æ„ä»€ä¹ˆï¼Ÿ')">é«˜è¡€å‹æ‚£è€…åº”è¯¥æ³¨æ„ä»€ä¹ˆï¼Ÿ</li>
                        <li onclick="fillQuestion('å¿ƒè¡€ç®¡ç–¾ç—…çš„æ—©æœŸç—‡çŠ¶æœ‰å“ªäº›ï¼Ÿ')">å¿ƒè¡€ç®¡ç–¾ç—…çš„æ—©æœŸç—‡çŠ¶æœ‰å“ªäº›ï¼Ÿ</li>
                        <li onclick="fillQuestion('å¦‚ä½•é€šè¿‡é¥®é£Ÿæ”¹å–„å¿ƒè¡€ç®¡å¥åº·ï¼Ÿ')">å¦‚ä½•é€šè¿‡é¥®é£Ÿæ”¹å–„å¿ƒè¡€ç®¡å¥åº·ï¼Ÿ</li>
                        <li onclick="fillQuestion('è¿åŠ¨å¯¹å¿ƒè¡€ç®¡å¥åº·æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ')">è¿åŠ¨å¯¹å¿ƒè¡€ç®¡å¥åº·æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</li>
                    </ul>
                </div>
            </div>
            
            <div class="result-section" id="resultSection">
                <div class="result-card">
                    <h3>ğŸ“ AI å›ç­”</h3>
                    <div class="answer-text" id="answerText"></div>
                </div>
                
                <div class="audio-player" id="audioPlayer" style="display: none;">
                    <h4>ğŸ”Š è¯­éŸ³æ’­æ”¾</h4>
                    <audio id="audioElement" controls></audio>
                </div>
                
                <div id="warningMessage"></div>
                <div id="errorMessage"></div>
            </div>
        </div>
    </div>
    
    <script>
        // API åœ°å€
        const API_URL = 'http://localhost:5000/qa_audio';
        
        // å…ƒç´ å¼•ç”¨
        const questionInput = document.getElementById('questionInput');
        const submitBtn = document.getElementById('submitBtn');
        const resultSection = document.getElementById('resultSection');
        const answerText = document.getElementById('answerText');
        const audioPlayer = document.getElementById('audioPlayer');
        const audioElement = document.getElementById('audioElement');
        const warningMessage = document.getElementById('warningMessage');
        const errorMessage = document.getElementById('errorMessage');
        
        // å›è½¦æäº¤
        questionInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitQuestion();
            }
        });
        
        // å¡«å……ç¤ºä¾‹é—®é¢˜
        function fillQuestion(question) {
            questionInput.value = question;
            questionInput.focus();
        }
        
        // æäº¤é—®é¢˜
        async function submitQuestion() {
            const question = questionInput.value.trim();
            
            if (!question) {
                alert('è¯·è¾“å…¥é—®é¢˜');
                return;
            }
            
            // ç¦ç”¨æŒ‰é’®
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span> å¤„ç†ä¸­...';
            
            // éšè—ä¹‹å‰çš„ç»“æœ
            resultSection.style.display = 'none';
            audioPlayer.style.display = 'none';
            warningMessage.innerHTML = '';
            errorMessage.innerHTML = '';
            
            try {
                console.log('å‘é€è¯·æ±‚:', question);
                
                // å‘é€è¯·æ±‚
                const response = await axios.post(API_URL, {
                    question: question
                }, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('å“åº”æ•°æ®:', response.data);
                
                // æ˜¾ç¤ºç»“æœ
                displayResult(response.data);
                
            } catch (error) {
                console.error('è¯·æ±‚å¤±è´¥:', error);
                
                let errorMsg = 'è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨è¿æ¥';
                
                if (error.response) {
                    errorMsg = error.response.data.error || errorMsg;
                } else if (error.request) {
                    errorMsg = 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿æœåŠ¡å™¨å·²å¯åŠ¨';
                }
                
                displayError(errorMsg);
            } finally {
                // æ¢å¤æŒ‰é’®
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'æäº¤é—®é¢˜';
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function displayResult(data) {
            if (!data.success) {
                displayError(data.error || 'å¤„ç†å¤±è´¥');
                return;
            }
            
            // æ˜¾ç¤ºæ–‡æœ¬å›ç­”
            answerText.textContent = data.text;
            resultSection.style.display = 'block';
            
            // æ˜¾ç¤ºéŸ³é¢‘
            if (data.audio_url) {
                audioElement.src = data.audio_url;
                audioPlayer.style.display = 'block';
                
                // è‡ªåŠ¨æ’­æ”¾ï¼ˆæŸäº›æµè§ˆå™¨å¯èƒ½é˜»æ­¢ï¼‰
                audioElement.play().catch(e => {
                    console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œè¯·æ‰‹åŠ¨ç‚¹å‡»æ’­æ”¾');
                });
            }
            
            // æ˜¾ç¤ºè­¦å‘Šï¼ˆå¦‚æœæœ‰ï¼‰
            if (data.warning) {
                warningMessage.className = 'warning';
                warningMessage.textContent = 'âš ï¸ ' + data.warning;
            }
            
            // æ»šåŠ¨åˆ°ç»“æœ
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // æ˜¾ç¤ºé”™è¯¯
        function displayError(message) {
            errorMessage.className = 'error';
            errorMessage.textContent = 'âŒ ' + message;
            resultSection.style.display = 'block';
        }
    </script>
</body>
</html>

