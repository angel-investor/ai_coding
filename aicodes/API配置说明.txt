============================================
  DeepSeek API 配置说明
============================================

问题: 语音问答功能报错 "文本生成失败"
原因: DeepSeek API Key 未配置

✅ 解决方案
============================================

方式 1: 使用批处理脚本 (推荐)
--------------------------------------------

1. 双击运行: 配置API_KEY.bat
   
   这将自动创建 .env 文件
   并配置好 DeepSeek API Key

2. 重启服务器
   start_predict_server.bat

3. 测试功能
   http://localhost:5000/web/qa_audio.html


方式 2: 使用主菜单
--------------------------------------------

1. 运行 START.bat

2. 选择: 2 (Configure API Keys)

3. 按提示操作

4. 选择: 4 (Start Prediction Server)

5. 测试功能


方式 3: 手动创建 .env 文件
--------------------------------------------

1. 在项目根目录创建 .env 文件
   位置: D:\project\workspace\ai_coding\aicodes\.env

2. 复制以下内容到 .env 文件:

# DeepSeek API Configuration
DEEPSEEK_API_KEY=sk-52e226ac3cac46838cb282b45b1a648e
DEEPSEEK_API_URL=https://api.deepseek.com/v1
MODEL=deepseek-chat

# CosyVoice Configuration (可选)
COSYVOICE_APPKEY=your_cosyvoice_appkey_here
COSYVOICE_TOKEN=your_cosyvoice_token_here

# Model Configuration
MODEL_PATH=./model/xgb_model.pkl
DATA_PATH=D:/project/workspace/ai_coding/data/心血管疾病.xlsx

# Flask Configuration
FLASK_HOST=0.0.0.0
FLASK_PORT=5000
FLASK_DEBUG=False

# Logging Configuration
LOG_LEVEL=INFO
LOG_DIR=./logs

3. 保存文件

4. 重启服务器


📋 验证配置
============================================

1. 启动服务器
   start_predict_server.bat

2. 查看启动日志
   应该看到:
   "DeepSeek LLM 初始化成功"

3. 访问语音问答页面
   http://localhost:5000/web/qa_audio.html

4. 输入问题并提交
   例如: "如何预防心血管疾病？"

5. 查看结果
   应该显示:
   • 文本回答
   • 音频播放器 (如果配置了 CosyVoice)


⚠️ 常见问题
============================================

Q1: 运行批处理后还是报错？
A: 需要重启服务器才能加载新的配置

Q2: 如何检查 .env 文件是否存在？
A: 在项目根目录查看是否有 .env 文件
   注意: .env 文件可能被隐藏

Q3: 如何修改 API Key？
A: 直接编辑 .env 文件
   然后重启服务器

Q4: CosyVoice 是必需的吗？
A: 不是必需的
   只配置 DeepSeek 也可以使用文本问答
   CosyVoice 只用于语音合成
   
Q5: 如何获取 CosyVoice API Key？
A: 访问阿里云百炼平台
   https://help.aliyun.com/zh/model-studio/get-api-key
   注册并获取 API Key
   将 API Key 填入 .env 文件的 COSYVOICE_APPKEY


🔍 日志查看
============================================

如果还有问题，查看日志:

启动日志:
  控制台输出

API 日志:
  logs/api.log

语音问答日志:
  logs/audio.log

查找关键信息:
  • "DEEPSEEK_API_KEY 未配置" - 需要配置 API Key
  • "DeepSeek LLM 初始化成功" - 配置正确
  • "语音问答流程完成" - 功能正常


📝 API Key 说明
============================================

DeepSeek API Key:
  • 格式: sk-xxxxxxxxxxxxxxxxxxxxxxxx
  • 获取: https://platform.deepseek.com/
  • 用途: 文本生成

CosyVoice API Key:
  • 格式: 阿里云 AppKey
  • 获取: https://help.aliyun.com/zh/model-studio/
  • 用途: 语音合成 (可选)


🎯 快速修复步骤
============================================

1. 运行: 配置API_KEY.bat
   ↓
2. 重启服务器: start_predict_server.bat
   ↓
3. 访问: http://localhost:5000/web/qa_audio.html
   ↓
4. 测试问答功能


============================================
  配置完成后记得重启服务器！
============================================

